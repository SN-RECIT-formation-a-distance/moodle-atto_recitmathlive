YUI.add("moodle-atto_recitmathlive-button",function(t,e){t.namespace("M.atto_recitmathlive").Button=t.Base.create("button",t.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({icon:"atto-icon",iconComponent:"atto_recitmathlive",callback:this.openModal,tags:"math, mtable, mtr, mtd, mrow mn"}),this.editor._node.addEventListener("click",this.onAttoClick.bind(this),!1),this.editor._node.addEventListener("keydown",this.onAttoKeyDown.bind(this))},myAttr:{popup:null,selectedNode:null},addRecitMathLiveReactJs(){var t,e,i,o="recitmathlivereactjs";document.getElementById(o)?this.onLoadUI():(t=(e=M.cfg.wwwroot)+"/lib/editor/atto/plugins/recitmathlive/react/build/index.js",e=e+"/lib/editor/atto/plugins/recitmathlive/react/build/index.css",(i=document.createElement("script")).onload=this.onLoadUI.bind(this),i.setAttribute("src",t),i.setAttribute("id",o),i.setAttribute("type","text/javascript"),document.getElementsByTagName("head")[0].appendChild(i),(i=document.createElement("link")).setAttribute("href",e),i.setAttribute("rel","stylesheet"),document.getElementsByTagName("head")[0].appendChild(i))},getMathMlElement(t){let e=null,i=t;for(;i&&i.tagName&&"math"===i.tagName.toLocaleLowerCase()&&(e=i),(i=i.parentNode)instanceof MathMLElement;);return e},onAttoKeyDown:function(t){var e=window.getSelection();if("Caret"===e.type){e=this.getMathMlElement(e.anchorNode);if(e)return t.preventDefault(),this.myAttr.selectedNode=e,this.openModal(),!1}},onAttoClick:function(t){t.stopPropagation();let e=null;t.target&&(e=this.getMathMlElement(t.target)),this.myAttr.selectedNode=e,this.myAttr.selectedNode&&this.openModal()},openModal:function(t){t&&t.preventDefault();t=document.createElement("div");t.setAttribute("id","recitmathlive_container"),this.createPopup(t),this.addRecitMathLiveReactJs()},createPopup:function(t){var e=document.createElement("div"),i=(e.classList.add("modal","fade"),e.setAttribute("style","overflow-y: hidden;"),document.createElement("div")),o=(i.classList.add("modal-dialog","modal-xl"),e.appendChild(i),document.createElement("div")),i=(o.classList.add("modal-content"),i.appendChild(o),document.createElement("div")),d=(i.classList.add("modal-header"),i.innerHTML="<h2>"+M.util.get_string("pluginname","atto_recitmathlive")+"</h2>",o.appendChild(i),document.createElement("button")),d=(d.classList.add("close"),d.innerHTML='<span aria-hidden="true">&times;</span>',d.setAttribute("data-dismiss","modal"),d.onclick=this.destroy.bind(this),i.appendChild(d),document.createElement("div"));d.classList.add("modal-body"),o.appendChild(d),d.appendChild(t),document.body.appendChild(e),this.myAttr.popup=e,this.myAttr.popup.classList.add("show"),this.myAttr.backdrop=document.createElement("div"),this.myAttr.backdrop.classList.add("modal-backdrop","fade","show"),this.myAttr.backdrop.setAttribute("data-backdrop","static"),document.body.appendChild(this.myAttr.backdrop)},destroy:function(){this.myAttr.popup.classList.remove("show"),this.myAttr.backdrop.classList.remove("show"),this.myAttr.popup.remove(),this.myAttr.backdrop.remove(),this.myAttr.selectedNode=null},update:function(){},onLoadUI:function(){if(!window.openrecitmathliveui)throw new Error("Interface openrecitmathliveui not defined.");var t={onClose:this.onClose.bind(this),onApply:this.onApply.bind(this),getContent:()=>this.myAttr.selectedNode?this.myAttr.selectedNode.outerHTML:""};window.openrecitmathliveui(t),this.update()},onApply:function(t){var e=this.get("host");e.focus(),this.myAttr.selectedNode&&this.myAttr.selectedNode.remove(),0<t.length&&e.insertContentAtFocusPoint(t),this.onClose()},onClose:function(){this.destroy()}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});