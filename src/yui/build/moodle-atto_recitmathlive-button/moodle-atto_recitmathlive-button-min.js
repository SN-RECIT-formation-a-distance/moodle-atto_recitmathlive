YUI.add("moodle-atto_recitmathlive-button",function(n,e){n.namespace("M.atto_recitmathlive").Button=n.Base.create("button",n.M.editor_atto.EditorPlugin,[],{TEMPLATE:'<div style="margin-bottom:20px;height:300px;overflow-y:auto" id="{{component}}inputblock"></div><div style="text-align:right"><button id="{{component}}close" class="btn btn-secondary">{{get_string "close" component}}</button><button class="btn btn-primary" id="{{component}}submit"> {{get_string "save" component}}</button></div>',COMPONENTNAME:"atto_recitmathlive",virtualKeyboard:{customVirtualKeyboardLayers:{Tab:{styles:"",rows:[[{"class":"",latex:"\\ce{H}"},{"class":"separator w10"},{"class":"separator w10"},{"class":"separator w10"},{"class":"separator w10"},{"class":"separator w10"},{"class":"separator w10"},{"class":"separator w10"},{latex:"\\ce{He}"}],[{latex:"\\ce{Li}"},{latex:"\\ce{Be}"},{"class":"separator w10"},{latex:"\\ce{B}"},{latex:"\\ce{C}"},{latex:"\\ce{N}"},{latex:"\\ce{O}"},{latex:"\\ce{F}"},{latex:"\\ce{Ne}"}],[{latex:"\\ce{Na}"},{latex:"\\ce{Mg}"},{"class":"separator w10"},{latex:"\\ce{Al}"},{latex:"\\ce{Si}"},{latex:"\\ce{P}"},{latex:"\\ce{S}"},{latex:"\\ce{Cl}"},{latex:"\\ce{Ar}"}],[{latex:"\\ce{K}"},{latex:"\\ce{Ca}"},{"class":"separator w10"},{latex:"\\ce{Ga}"},{latex:"\\ce{Ge}"},{latex:"\\ce{As}"},{latex:"\\ce{Se}"},{latex:"\\ce{Cl}"},{latex:"\\ce{Kr"}]]},chimie:{rows:[[{"class":"tex",latex:"x",aside:"Variables usuelles",variants:[{"class":"tex",latex:"C",aside:"concentration"},{"class":"tex",latex:"m",aside:"masse"},{"class":"tex",latex:"M",aside:"masse molaire"},{"class":"tex",latex:"n",aside:"nombre de particules"},{"class":"tex",latex:"V",aside:"volume"},{"class":"tex",latex:"T",aside:"température"},{"class":"tex",latex:"\\Delta{T}",aside:"variation de tempéature..."},{"class":"tex",latex:"t",aside:"temps"},{"class":"tex",latex:"\\Delta{t}",aside:"variation de temps..."},{"class":"tex",latex:"\\vec{s}",aside:"position"},{"class":"tex",latex:"\\overrightarrow{\\Delta{s}}",aside:"variation de position..."},{"class":"tex",latex:"\\vec{v}",aside:"vitesse"},{"class":"tex",latex:"\\overrightarrow{\\Delta{v}}",aside:"variation de vitesse..."},{"class":"tex",latex:"\\vec{a}",aside:"accélération"},{"class":"tex",latex:"\\overrightarrow{\\Delta{a}}",aside:"variation d'accélération'..."},{"class":"tex",latex:"\\theta_i",aside:"angle d'indidence"},{"class":"tex",latex:"\\theta_r",aside:"angle de réfl/réfra"}]},{latex:"\\ce{ H2O}",insert:"\\(\\ce{H2O}\\)"}],[{"class":"tex",latex:"m/s^2",aside:"Unités",variants:[{"class":"tex",latex:"^\\circ{C}",aside:"degrés Celcius"},{"class":"tex",latex:"m",aside:"mètres"},{"class":"tex",latex:"m/s",aside:"mètres par seconde "},{"class":"tex",latex:"m/s^2",aside:"mètres par seconde carrée"},{"class":"tex",latex:"s",aside:"secondes"},{"class":"tex",latex:"N",aside:"Newton"},{"class":"tex",latex:"W",aside:"Watt"},{"class":"tex",latex:"J",aside:"Joules"},{"class":"tex",latex:"g",aside:"grammes"},{"class":"tex",latex:"l",aside:"litres"},{"class":"tex",latex:"K",aside:"Kelvin"},{"class":"tex",latex:"mol",aside:"mol"},{"class":"tex",latex:"mol/l",aside:"mol/l"},{"class":"tex",latex:"M",aside:"(molaire) mol par litre"},{"class":"tex",latex:"A",aside:"Ampères"},{"class":"tex",latex:"V",aside:"Volt"},{"class":"tex",latex:"\\Omega",aside:"ohms"}]}],[{latex:"\\sqrt{#@}"},{latex:"\\pm"},{latex:"\\overarc{#@}"},{latex:"\\sim"},{"class":"w15",latex:"#@_{#?}"}],[{"class":"separator w20"},{"class":"separator w20"},{"class":"separator w20"},{"class":"separator w15"},{"class":"action",label:"<svg><use xlink:href='#svg-arrow-left' /></svg>",command:["performWithFeedback","moveToPreviousChar"]},{"class":"action",label:"<svg><use xlink:href='#svg-arrow-right' /></svg>",command:["performWithFeedback","moveToNextChar"]}]]},Math:{styles:"",rows:[[{aside:"et autres...",latex:"\\(\\left(#@\\right)\\)",insert:"\\(\\left(#@\\right)\\)",variants:["\\lbrace","\\rbrace","\\lparen","\\rparen","\\langle","\\rangle","\\vert"]},{aside:"et autres...","class":"small",latex:"\\frac{#0}{#0}",insert:"$$\\frac{#0}{#0}$$",variants:[{latex:"\\nicefrac{#0}{#0} ",insert:"$$\\nicefrac{#0}{#0}$$"}]},{latex:"\\vec{#@}"},{aside:"autres constantes...",latex:"\\pi",variants:[{aside:"Pi",latex:"\\pi"},{aside:"Plank",latex:"\\hbar"},{aside:"Vitesse lumière",latex:"c"},{aside:"Gravitation universelle ",latex:"G"},{aside:"Constante des gaz parfait",latex:"k"}]},{"class":"separator w5"},{label:"7",key:"7"},{label:"8",key:"8"},{label:"9",key:"9"},{latex:"\\div"}],[{aside:"et autres...","class":"small",latex:"\\sin\\left( #@ \\right)",variants:[{"class":"small",latex:"\\sin^{-1}\\left( #@ \\right)"},{"class":"small",latex:"\\arcsin(#0)"}]},{aside:"et autres...","class":"small",latex:"\\sqrt{#@}",insert:"\\(\\sqrt{#@}\\)",variants:[{"class":"small",latex:"\\sqrt[{#?}]{{#?}}",insert:"\\(\\sqrt[{#?}]{{#?}}\\)"}]},{aside:"et autres...","class":"small",latex:"\\leftrightarrow",insert:"$$\\leftrightarrow$$",variants:[{latex:"\\longleftrightarrow",insert:"$$\\longleftrightarrow$$"},{latex:"\\Leftrightarrow",insert:"$$\\Leftrightarrow$$"},{latex:"\\Longleftrightarrow",insert:"$$\\Longleftrightarrow$$"},{latex:"\\rightarrow",insert:"$$\\rightarrow$$"},{latex:"\\longrightarrow",insert:"$$\\longrightarrow$$"},{latex:"\\rightarrow",insert:"$$\\rightarrow$$"},{latex:"\\Longrightarrow",insert:"$$\\Longrightarrow$$"},{"class":"small",latex:"\\rightleftharpoons",insert:"$$\\rightleftharpoons$$"},{latex:"\\rightleftharpoons",insert:"$$\\rightleftharpoons$$"},{latex:"\\Leftrightharpoons",insert:"$$\\Leftrightharpoons$$"},{latex:"\\Longleftrightharpoons",insert:"$$\\Longleftrightharpoons$$"},{"class":"small",latex:"\\leftarrow",insert:"$$\\leftarrow$$"},{latex:"\\longleftarrow",insert:"$$\\longleftarrow$$"},{latex:"\\Leftarrow",insert:"$$\\Leftarrow$$"},{latex:"\\Longleftarrow",insert:"$$\\Longleftarrow$$"}]},{"class":"tex",latex:"x",aside:"Variables usuelles",variants:[{"class":"tex",latex:"C",aside:"concentration"},{"class":"tex",latex:"m",
aside:"masse"},{"class":"tex",latex:"M",aside:"masse molaire"},{"class":"tex",latex:"n",aside:"nombre de particules"},{"class":"tex",latex:"V",aside:"volume"},{"class":"tex",latex:"T",aside:"température"},{"class":"tex",latex:"\\Delta{T}",aside:"variation de tempéature..."},{"class":"tex",latex:"t",aside:"temps"},{"class":"tex",latex:"\\Delta{t}",aside:"variation de temps..."},{"class":"tex",latex:"\\vec{s}",aside:"position"},{"class":"tex",latex:"\\overrightarrow{\\Delta{s}}",aside:"variation de position..."},{"class":"tex",latex:"\\vec{v}",aside:"vitesse"},{"class":"tex",latex:"\\overrightarrow{\\Delta{v}}",aside:"variation de vitesse..."},{"class":"tex",latex:"\\vec{a}",aside:"accélération"},{"class":"tex",latex:"\\overrightarrow{\\Delta{a}}",aside:"variation d'accélération'..."},{"class":"tex",latex:"\\theta_i",aside:"angle d'indidence"},{"class":"tex",latex:"\\theta_r",aside:"angle de réfl/réfra"}]},{"class":"separator w5"},{label:"4",key:"4"},{label:"5",key:"5"},{label:"6",key:"6"},{latex:"\\times",variants:["\\cdot","\\ast","\\star","\\bigstar","\\ltimes","\\rtimes","\\rightthreetimes","\\leftthreetimes","\\interc","\\prod",{latex:"\\prod_{n\\mathop=0}^{\\infty}","class":"small"}]}],[{aside:"et autres...","class":"small",latex:"\\cos\\left( #0 \\right)",variants:[{"class":"small",latex:"\\cos^{-1}\\left( #@ \\right)"},{"class":"small",latex:"\\arccos(#0)"}]},{aside:"et autres...",latex:"\\({#@}_{#@}\\)",variants:[{aside:"exposant",latex:"\\({#@}^{#@}\\)"}]},{latex:"^\\circ"},{"class":"tex",latex:"m/s^2",aside:"Unités",variants:[{"class":"tex",latex:"^\\circ{C}",aside:"degrés Celcius"},{"class":"tex",latex:"m",aside:"mètres"},{"class":"tex",latex:"m/s",aside:"mètres par seconde "},{"class":"tex",latex:"m/s^2",aside:"mètres par seconde carrée"},{"class":"tex",latex:"s",aside:"secondes"},{"class":"tex",latex:"N",aside:"Newton"},{"class":"tex",latex:"W",aside:"Watt"},{"class":"tex",latex:"J",aside:"Joules"},{"class":"tex",latex:"g",aside:"grammes"},{"class":"tex",latex:"l",aside:"litres"},{"class":"tex",latex:"K",aside:"Kelvin"},{"class":"tex",latex:"mol",aside:"mol"},{"class":"tex",latex:"mol/l",aside:"mol/l"},{"class":"tex",latex:"M",aside:"(molaire) mol par litre"},{"class":"tex",latex:"A",aside:"Ampères"},{"class":"tex",latex:"V",aside:"Volt"},{"class":"tex",latex:"\\Omega",aside:"ohms"}]},{"class":"separator w5"},{label:"1",key:"1"},{label:"2",key:"2"},{label:"3",key:"3"},{latex:"-",variants:["\\pm","\\mp","\\ominus","\\vert #0  \\vert"]}],[{aside:"et autres...","class":"small",latex:"\\tan\\left( #0 \\right)",variants:[{"class":"small",latex:"\\tan^{-1}\\left( #@ \\right)"},{"class":"small",latex:"\\arctan(#0)"}]},{"class":"action",label:"<svg><use xlink:href='#svg-arrow-left' /></svg>",command:["performWithFeedback","moveToPreviousChar"]},{"class":"action",label:"<svg><use xlink:href='#svg-arrow-right' /></svg>",command:["performWithFeedback","moveToNextChar"]},{"class":"action font-glyph bottom right",label:"&#x232b;",command:["performWithFeedback","deleteBackward"]},{"class":"separator w5"},{label:"0",key:"0"},{latex:"."},{latex:"=",variants:[{latex:"\\neq"},{latex:"\\approx"},{latex:"\\cong"}]},{latex:"+",variants:["\\pm","\\mp","\\sum",{latex:"\\sum_{n\\mathop=0}^{\\infty}","class":"small"},"\\dotplus","\\oplus"]}]]}},customVirtualKeyboards:{Tab:{label:"Tableau periodique",tooltip:"Tableau périodique des principaux éléments",layer:"Tab"},chimie:{label:"Science usuelle",tooltip:"Notations symboliques usuelles en science et technologie",layer:"chimie"},highschoolkeyboard:{label:"Symboles usuelles",tooltip:"Notations symboliques usuelles",layer:"Math"}},virtualKeyboards:"highschoolkeyboard Tab greek symbols functions "},_currentSelection:null,_content:null,stream:null,math:null,initializer:function(){var e,t,a;this.get("host").canShowFilepicker("media")&&(this.addButton({title:"pluginname",icon:"e/math",iconComponent:this.COMPONENTNAME,callback:this.open,buttonName:"recitmathlive"}),e=M.cfg.wwwroot+"/lib/editor/atto/plugins/recitmathlive/js/",t=this,document.getElementById("recitmathcanvas")||((a=document.createElement("script")).setAttribute("src",e+"html2canvas.min.js"),a.setAttribute("id","recitmathcanvas"),a.setAttribute("type","text/javascript"),document.getElementsByTagName("head")[0].appendChild(a)),requirejs([e+"mathlive.min.js"],function(e){window.MathLive=e;e=t.get("host").textarea.ancestor("form");e&&e.on("submit",t.submitAtto,t),setTimeout(t.renderMath.bind(t),500)}),M.filter_mathjaxloader&&window.MathJax?M.filter_mathjaxloader.typeset():document.getElementById("recitmathjax")||(window.MathJax={jax:["input/TeX","output/SVG"],extensions:["tex2jax.js","MathMenu.js","MathZoom.js"],showMathMenu:!1,showProcessingMessages:!1,messageStyle:"none",SVG:{useGlobalCache:!1},TeX:{extensions:["AMSmath.js","AMSsymbols.js","autoload-all.js"]}},(a=document.createElement("script")).setAttribute("src","https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/latest.js"),a.setAttribute("id","recitmathjax"),a.setAttribute("type","text/javascript"),document.getElementsByTagName("head")[0].appendChild(a)))},getSelectedNode:function(){var e=document.getSelection().anchorNode;return e?3==e.nodeType?e.parentNode:e:null},open:function(){var e,i,t,a,r,o,s,l;if(this.dialogue=this.getDialogue({headerContent:M.util.get_string("pluginname",this.COMPONENTNAME),focusAfterHide:!0,width:"auto",height:"auto"}),(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))&&window.scrollTo(0,1),a="f(x)=",this.selectedNode||(t=this.getSelectedNode(),(t=this.getParentFromClass(t,this.COMPONENTNAME+"block"))&&t.classList.contains(this.COMPONENTNAME+"block")&&(this.selectedNode=t)),e=[],this.selectedNode&&(e=this.selectedNode.querySelectorAll("."+this.COMPONENTNAME)),t=n.Handlebars.compile(this.TEMPLATE),a=n.Node.create(t({elementid:this.get("host").get("elementid"),component:this.COMPONENTNAME,width:.8*window.innerWidth,height:.8*window.innerHeight})),this.dialogue.set("bodyContent",a).show(),
i=document.getElementById(this.COMPONENTNAME+"inputblock"),t=document.getElementById(this.COMPONENTNAME+"close"),a=document.getElementById(this.COMPONENTNAME+"submit"),o=(r=this).get("host"),this.plus=document.createElement("a"),this.plus.innerHTML="<i class='fa fa-plus'></i><br>",this.plus.href="#",this.plus.style.color="#000",this.plus.addEventListener("click",()=>{this.createField("",!0)}),i.append(this.plus),0==e.length)r.createField("f(x)=",!1);else for(s of e)l=s.getAttribute("data-latex"),r.createField(l,!0);t.addEventListener("click",function(e){e.preventDefault(),r.close()}),a.addEventListener("click",function(e){var t,a,s,l;e.preventDefault(),t="";for(a of i.getElementsByTagName("math-field"))0<(s=a.getValue("latex")).trim().length&&(l=r.formatForMathJaxFilter(s),t=t+"<span class='"+r.COMPONENTNAME+"block'><span class='"+r.COMPONENTNAME+"' data-latex='"+s+"'>"+l+"</span><br></span>");o.focus(),o.restoreSelection(),r.selectedNode?r.selectedNode.innerHTML=t:o.insertContentAtFocusPoint(t),r.close(),setTimeout(function(){r.renderMath(),r.markUpdated()},500)},!1),i.addEventListener("keypress",function(e){"Enter"===e.key&&r.createField("",!0)})},createField(e,t,a){var s,l=document.createElement("div");t&&((s=document.createElement("a")).innerHTML="<i class='fa fa-plus'></i><br>",s.href="#",s.style.color="#000",s.addEventListener("click",()=>{this.createField("",!0,l)}),l.append(s)),document.getElementById(this.COMPONENTNAME+"inputblock");const i=new MathfieldElement;i.classList.add("d-inline-block"),i.setAttribute("style","min-width:300px;"),i.value=e,i.setOptions({virtualKeyboardMode:"onfocus",...this.virtualKeyboard}),l.append(i),t&&((s=document.createElement("a")).innerHTML="<i class='fa fa-times'></i>",s.href="#",s.style.color="#ff0000",s.addEventListener("click",()=>{i.remove(),s.remove()}),l.append(s)),(a||this.plus).before(l),i.focus()},submitAtto(){this.unrenderMath(),this.markUpdated()},formatForMathJaxFilter(e){return"\\("+(e=e.replace(" ","\\ "))+"\\)"},doubleClickHandler(e){var t=this.getParentFromClass(e.target,this.COMPONENTNAME+"block");t&&(this.selectedNode=t,e.stopPropagation(),this.open())},getParentFromClass(e,t){if(!e)return!1;if(e.classList.contains(t))return e;for(;e=e.parentElement;)if(e.classList.contains(t))return e;return!1},tex2img(e,l,i){MathJax.Hub.Queue(function(){var s=MathJax.HTML.Element("span",{},e);MathJax.Hub.Typeset(s,()=>{var t,a,e=s.getElementsByTagName("svg")[0];if(!e)return(t=document.createElement("div")).style.width="fit-content",t.innerHTML=s.innerHTML,document.body.appendChild(t),void html2canvas(t).then(e=>{e='<img src="'+e.toDataURL("image/png")+'"/>';l(e,i),t.remove()});e.setAttribute("xmlns","http://www.w3.org/2000/svg"),(a=new Image).src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(e.outerHTML))),a.onload=function(){var e=document.createElement("canvas");e.width=a.width,e.height=a.height,e.getContext("2d").drawImage(a,0,0),e='<img src="'+e.toDataURL("image/png")+'"/>',l(e,i)}})})},renderMath(){var e=this.get("host").editor.getDOMNode(),e=e.querySelectorAll("."+this.COMPONENTNAME);this.renderBlock(e,0)},renderBlock(a,s){var e,t;a[s]&&(t=(e=a[s]).getAttribute("data-latex"),e.onclick=this.doubleClickHandler.bind(this),t=this.formatForMathJaxFilter(t),this.tex2img(t,(e,t)=>{t.innerHTML=e,t.setAttribute("contenteditable","false"),this.renderBlock(a,s+1)},e))},unrenderMath(){var e,t,a=this.get("host").editor.getDOMNode(),a=a.querySelectorAll("."+this.COMPONENTNAME);for(e of a)t=e.getAttribute("data-latex"),e.innerHTML=this.formatForMathJaxFilter(t)},close:function(){this.getDialogue({focusAfterHide:null}).hide(),this.selectedNode=null}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});