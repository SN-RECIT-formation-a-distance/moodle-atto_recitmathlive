YUI.add("moodle-atto_recitmathlive-button",function(t,e){t.namespace("M.atto_recitmathlive").Button=t.Base.create("button",t.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({icon:"e/math",callback:this.openModal,tags:"math, mtable, mtr, mtd, mrow mn"}),this.editor._node.addEventListener("click",this.onAttoClick.bind(this),!1)},myAttr:{popup:null,selectedNode:null},addRecitMathLiveReactJs(){var t,e,i="recitmathlivereactjs";document.getElementById(i)?this.onLoadUI():(t=M.cfg.wwwroot+"/lib/editor/atto/plugins/recitmathlive/react/build/index.js",(e=document.createElement("script")).onload=this.onLoadUI.bind(this),e.setAttribute("src",t),e.setAttribute("id",i),e.setAttribute("type","text/javascript"),document.getElementsByTagName("head")[0].appendChild(e))},getMathMlElement(t){let e=null,i=t;for(;i instanceof MathMLElement;)"math"===i.tagName.toLocaleLowerCase()&&(e=i),i=i.parentNode;return e},onAttoClick:function(t){t.stopPropagation();let e=null;t.target&&(e=this.getMathMlElement(t.target)),this.myAttr.selectedNode=e,this.myAttr.selectedNode&&this.openModal()},openModal:function(t){t&&t.preventDefault();t=document.createElement("div");t.setAttribute("id","recitmathlive_container"),this.createPopup(t),this.addRecitMathLiveReactJs()},createPopup:function(t){var e=document.createElement("div"),i=(e.classList.add("modal","fade"),e.setAttribute("style","overflow-y: hidden;"),document.createElement("div")),o=(i.classList.add("modal-dialog"),e.appendChild(i),document.createElement("div")),i=(o.classList.add("modal-content"),o.setAttribute("style","width:600px;padding:10px"),i.appendChild(o),document.createElement("div")),d=(i.classList.add("modal-header"),i.innerHTML="<h2>"+M.util.get_string("pluginname","atto_recitmathlive")+"</h2>",o.appendChild(i),document.createElement("button")),d=(d.classList.add("close"),d.innerHTML='<span aria-hidden="true">&times;</span>',d.setAttribute("data-dismiss","modal"),i.appendChild(d),document.createElement("div"));d.classList.add("modal-body"),o.appendChild(d),d.appendChild(t),document.body.appendChild(e),this.myAttr.popup=e,$(e).modal({show:!0,backdrop:"static",keyboard:!1});let n=this;$(e).on("hidden.bs.modal",function(t){n.destroy()})},destroy:function(){$(this.myAttr.popup).modal("hide"),this.myAttr.popup.remove(),this.myAttr.selectedNode=null},update:function(){$(this.myAttr.popup).modal("handleUpdate")},onLoadUI:function(){if(!window.openrecitmathliveui)throw new Error("Interface openrecitmathliveui not defined.");var t={onClose:this.onClose.bind(this),onApply:this.onApply.bind(this),getContent:()=>this.myAttr.selectedNode?this.myAttr.selectedNode.outerHTML:""};window.openrecitmathliveui(t),this.update()},onApply:function(t){var e=this.get("host");e.focus(),this.myAttr.selectedNode&&this.myAttr.selectedNode.remove(),0<t.length&&e.insertContentAtFocusPoint(t),this.onClose()},onClose:function(){this.destroy()}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});