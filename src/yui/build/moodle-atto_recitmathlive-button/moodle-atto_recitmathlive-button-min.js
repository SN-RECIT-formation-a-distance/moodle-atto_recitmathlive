YUI.add("moodle-atto_recitmathlive-button",function(t,e){t.namespace("M.atto_recitmathlive").Button=t.Base.create("button",t.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({title:"pluginname",icon:"math",iconComponent:"atto_recitmathlive",callback:this.openModal,buttonName:"recitmathlive"}),this.editor._node.addEventListener("click",this.onAttoClick.bind(this),!1)},myAttr:{popup:null,selectedNode:null},onAttoClick:function(e){e.stopPropagation();let i=null;if(e.target){let t=e.target;for(;t instanceof MathMLElement;)"math"===t.tagName.toLocaleLowerCase()&&(i=t),t=t.parentNode}this.myAttr.selectedNode=i,this.myAttr.selectedNode&&this.openModal()},openModal:function(t){var e;t&&t.preventDefault(),t=M.cfg.wwwroot+"/lib/editor/atto/plugins/recitmathlive/react/build/index.js",(e=document.createElement("div")).setAttribute("id","recitmathlive_container"),this.createPopup(e),(e=document.createElement("script")).onload=this.onloadUi.bind(this),e.setAttribute("src",t),e.setAttribute("id","recitmathlive"),e.setAttribute("type","text/javascript"),document.getElementsByTagName("head")[0].appendChild(e)},createPopup:function(t){var e=document.createElement("div"),i=(e.classList.add("modal","fade","autolink_popup"),e.setAttribute("style","overflow-y: hidden;"),document.createElement("div")),o=(i.classList.add("modal-dialog"),e.appendChild(i),document.createElement("div")),i=(o.classList.add("modal-content"),o.setAttribute("style","width:600px;padding:10px"),i.appendChild(o),document.createElement("div")),n=(i.classList.add("modal-header"),i.innerHTML="<h2>"+M.util.get_string("pluginname","atto_recitmathlive")+"</h2>",o.appendChild(i),document.createElement("button")),n=(n.classList.add("close"),n.innerHTML='<span aria-hidden="true">&times;</span>',n.setAttribute("data-dismiss","modal"),i.appendChild(n),document.createElement("div"));n.classList.add("modal-body"),o.appendChild(n),n.appendChild(t),document.body.appendChild(e),this.myAttr.popup=e,$(e).modal({show:!0,backdrop:!0});let d=this;$(".modal-backdrop").click(()=>$(this.myAttr.popup).modal("hide")),$(e).on("hidden.bs.modal",function(t){d.destroy()})},destroy:function(){$(this.myAttr.popup).modal("hide"),this.myAttr.popup.remove(),this.myAttr.selectedNode=null},update:function(){$(this.myAttr.popup).modal("handleUpdate")},onloadUi:function(){if(!window.openrecitmathliveui)throw new Error("Interface openrecitmathliveui not defined.");var t={onClose:this.onClose.bind(this),onApply:this.onApply.bind(this),getContent:()=>this.myAttr.selectedNode?this.myAttr.selectedNode.outerHTML:""};window.openrecitmathliveui(t),this.update()},onApply:function(t){var e;0!==t.length&&((e=this.get("host")).focus(),this.myAttr.selectedNode&&this.myAttr.selectedNode.remove(),e.insertContentAtFocusPoint(t)),this.onClose()},onClose:function(){this.destroy()}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});