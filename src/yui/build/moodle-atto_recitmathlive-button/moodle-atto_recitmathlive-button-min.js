YUI.add("moodle-atto_recitmathlive-button",function(t,e){t.namespace("M.atto_recitmathlive").Button=t.Base.create("button",t.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({icon:"atto-icon",iconComponent:"atto_recitmathlive",callback:this.openModal,tags:"math, mtable, mtr, mtd, mrow mn"}),this.editor._node.addEventListener("click",this.onAttoClick.bind(this),!1),this.editor._node.addEventListener("keydown",this.onAttoKeyDown.bind(this))},myAttr:{popup:null,selectedNode:null},addRecitMathLiveReactJs(){var t,e,o="recitmathlivereactjs";document.getElementById(o)?this.onLoadUI():(t=M.cfg.wwwroot+"/lib/editor/atto/plugins/recitmathlive/react/build/index.js",(e=document.createElement("script")).onload=this.onLoadUI.bind(this),e.setAttribute("src",t),e.setAttribute("id",o),e.setAttribute("type","text/javascript"),document.getElementsByTagName("head")[0].appendChild(e))},getMathMlElement(t){let e=null,o=t;for(;o&&o.tagName&&"math"===o.tagName.toLocaleLowerCase()&&(e=o),(o=o.parentNode)instanceof MathMLElement;);return e},onAttoKeyDown:function(t){var e=window.getSelection();if("Caret"===e.type&&this.getMathMlElement(e.anchorNode))return t.preventDefault(),!1},onAttoClick:function(t){t.stopPropagation();let e=null;t.target&&(e=this.getMathMlElement(t.target)),this.myAttr.selectedNode=e,this.myAttr.selectedNode&&this.openModal()},openModal:function(t){t&&t.preventDefault();t=document.createElement("div");t.setAttribute("id","recitmathlive_container"),this.createPopup(t),this.addRecitMathLiveReactJs()},createPopup:function(t){var e=document.createElement("div"),o=(e.classList.add("modal","fade"),e.setAttribute("style","overflow-y: hidden;"),document.createElement("div")),i=(o.classList.add("modal-dialog","modal-xl"),e.appendChild(o),document.createElement("div")),o=(i.classList.add("modal-content"),o.appendChild(i),document.createElement("div")),n=(o.classList.add("modal-header"),o.innerHTML="<h2>"+M.util.get_string("pluginname","atto_recitmathlive")+"</h2>",i.appendChild(o),document.createElement("button")),n=(n.classList.add("close"),n.innerHTML='<span aria-hidden="true">&times;</span>',n.setAttribute("data-dismiss","modal"),o.appendChild(n),document.createElement("div"));n.classList.add("modal-body"),n.style.overflowY="auto",n.style.maxHeight=window.innerHeight-110+"px",i.appendChild(n),n.appendChild(t),document.body.appendChild(e),this.myAttr.popup=e,$(e).modal({show:!0,backdrop:"static",keyboard:!1});let d=this;$(e).on("hidden.bs.modal",function(t){d.destroy()})},destroy:function(){$(this.myAttr.popup).modal("hide"),this.myAttr.popup.remove(),this.myAttr.selectedNode=null},update:function(){$(this.myAttr.popup).modal("handleUpdate")},onLoadUI:function(){if(!window.openrecitmathliveui)throw new Error("Interface openrecitmathliveui not defined.");var t={onClose:this.onClose.bind(this),onApply:this.onApply.bind(this),getContent:()=>this.myAttr.selectedNode?this.myAttr.selectedNode.outerHTML:""};window.openrecitmathliveui(t),this.update()},onApply:function(t){var e=this.get("host");e.focus(),this.myAttr.selectedNode&&this.myAttr.selectedNode.remove(),0<t.length&&e.insertContentAtFocusPoint(t),this.onClose()},onClose:function(){this.destroy()}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});